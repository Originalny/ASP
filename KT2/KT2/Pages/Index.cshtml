@page
@model IndexModel
@{
    ViewData["Title"] = "Text Editor";
}

<h2>Text Editor</h2>
<form method="post">
    <textarea id="editor" name="UserText" rows="10" cols="80">@Model.UserText</textarea>
    <br />
    <button type="submit">Save</button>
</form>

@if (!string.IsNullOrEmpty(Model.UserText))
{
    <h3>Text Preview</h3>
    <div style="border:1px solid #ccc; padding:10px; background:#f9f9f9">@Html.Raw(Model.UserText)</div>
}

@section Scripts{
    <script src="https://cdn.tiny.cloud/1/m6mnwnon0s606ker53d6357evfl3g4yvgzowy6twpms2kb1z/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
<script>
    tinymce.init({
        selector: `#editor`,
        height: 400,
        plugins: `image lists link`,
        menubar: false,
        images_upload_url: `/Upload`,
        automatic_uploads: true,
        images_upload_handler: function(blobInfo, success, failure) {
            var formData = new FormData();
            formData.append(`file`, blobInfo.blob(), blobInfo.filename);
            fetch(`/Upload`, {
                method: `POST`,
                body: formData,
            })
            .then(res => res.json())
            .then(json => {success(json.location);})
            .catch(err => {failure(`Error with image upload` + err.message);});
        },
        toolbar: `bold italic underline | bullist numlist | undo redo | image`,
    });
</script>
}